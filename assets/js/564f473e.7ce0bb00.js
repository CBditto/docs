"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[5745],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var l=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,l)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,l,a=function(e,t){if(null==e)return{};var n,l,a={},i=Object.keys(e);for(l=0;l<i.length;l++)n=i[l],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(l=0;l<i.length;l++)n=i[l],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=l.createContext({}),c=function(e){var t=l.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},p=function(e){var t=c(e.components);return l.createElement(s.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return l.createElement(l.Fragment,{},t)}},k=l.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,s=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),u=c(n),k=a,m=u["".concat(s,".").concat(k)]||u[k]||d[k]||i;return n?l.createElement(m,r(r({ref:t},p),{},{components:n})):l.createElement(m,r({ref:t},p))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,r=new Array(i);r[0]=k;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[u]="string"==typeof e?e:a,r[1]=o;for(var c=2;c<i;c++)r[c]=n[c];return l.createElement.apply(null,r)}return l.createElement.apply(null,n)}k.displayName="MDXCreateElement"},32693:(e,t,n)=>{n.r(t),n.d(t,{contentTitle:()=>r,default:()=>p,frontMatter:()=>i,metadata:()=>o,toc:()=>s});var l=n(87462),a=(n(67294),n(3905));const i={title:"4 - Editing Tasks"},r=void 0,o={unversionedId:"tutorial/xamarin/edit-screen",id:"tutorial/xamarin/edit-screen",isDocsHomePage:!1,title:"4 - Editing Tasks",description:"Now, we will implement the TasksTableSource class we called earlier.",source:"@site/docs/csharp/tutorial/xamarin/4-edit-screen.md",sourceDirName:"tutorial/xamarin",slug:"/tutorial/xamarin/edit-screen",permalink:"/csharp/tutorial/xamarin/edit-screen",editUrl:"https://github.com/getditto/docs/tree/main/docs/csharp/tutorial/xamarin/4-edit-screen.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{title:"4 - Editing Tasks"},sidebar:"docs",previous:{title:"3 - Showing the List of Tasks",permalink:"/csharp/tutorial/xamarin/tasks-list-screen"},next:{title:"1 - Setup",permalink:"/csharp/tutorial/console/setup"}},s=[{value:"4-1 Creating the <code>TaskTableSource</code> class",id:"4-1-creating-the-tasktablesource-class",children:[],level:2},{value:"4-4 Final Application",id:"4-4-final-application",children:[],level:2}],c={toc:s};function p(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,l.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Now, we will implement the ",(0,a.kt)("inlineCode",{parentName:"p"},"TasksTableSource")," class we called earlier."),(0,a.kt)("h2",{id:"4-1-creating-the-tasktablesource-class"},"4-1 Creating the ",(0,a.kt)("inlineCode",{parentName:"h2"},"TaskTableSource")," class"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Open File->New File-> Empty Class (C#) and name it ",(0,a.kt)("inlineCode",{parentName:"li"},"TaskTableSource")),(0,a.kt)("li",{parentName:"ol"},"Import UIKit with ",(0,a.kt)("inlineCode",{parentName:"li"},"using UIKit")),(0,a.kt)("li",{parentName:"ol"},"This class will implement UITableViewSource.")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp",metastring:'title="TaskTableSource.cs"',title:'"TaskTableSource.cs"'},"using System;\nusing Foundation;\nusing UIKit;\n\nnamespace Tasks\n{\n    public class TaskTableSource : UITableViewSource\n    {\n        public TaskTableSource()\n        {\n        }\n\n        public override UITableViewCell GetCell(UITableView tableView, NSIndexPath indexPath)\n        {\n            throw new NotImplementedException();\n        }\n\n        public override nint RowsInSection(UITableView tableview, nint section)\n        {\n            throw new NotImplementedException();\n        }\n    }\n}\n")),(0,a.kt)("p",null,"Now we need to get our instance of Ditto and setup the other class variables we will be using."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp",metastring:'title="TaskTableSource.cs"',title:'"TaskTableSource.cs"'},'public class TaskTableSource : UITableViewSource\n{\n    Task[] tasks;\n    NSString cellIdentifier = new NSString("taskCell");\n\n    private DittoCollection collection\n    {\n        get\n        {\n            return this.ditto.Store.Collection("tasks");\n        }\n    }\n\n    private Ditto ditto\n    {\n        get\n        {\n            var appDelegate = (AppDelegate)UIApplication.SharedApplication.Delegate;\n            return appDelegate.ditto;\n        }\n    }\n    public TaskTableSource()\n    {\n    }\n\n    public override UITableViewCell GetCell(UITableView tableView, NSIndexPath indexPath)\n    {\n        throw new NotImplementedException();\n    }\n\n    public override nint RowsInSection(UITableView tableview, nint section)\n    {\n        throw new NotImplementedException();\n    }\n}\n')),(0,a.kt)("p",null,"Next thing we will implement is the ",(0,a.kt)("inlineCode",{parentName:"p"},"UITableViewSource")," inherited methods ",(0,a.kt)("inlineCode",{parentName:"p"},"GetCell")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"RowsInSection"),"."),(0,a.kt)("p",null,"RowsInSection:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Check whether the tasks array is empty. If its not empty then return the number of tasks in the tasks array.")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},"public override nint RowsInSection(UITableView tableview, nint section)\n{\n    if (this.tasks == null)\n    {\n        return 0;\n    }\n    return tasks.Length;\n}\n")),(0,a.kt)("p",null,"GetCell:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Get the cell using the cell identifier"),(0,a.kt)("li",{parentName:"ol"},"Within our cell we want a text label and a cell accessory that will be used to check whether the task has been completed or not. We will assign the name of the task to the TextLabel.Text."),(0,a.kt)("li",{parentName:"ol"},"Setup a tap gesture that will update whether the task has been completed or not. When tapped, we will update the task document inside the Ditto Collection and update the ",(0,a.kt)("inlineCode",{parentName:"li"},"isCompleted")," key.")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},'public override UITableViewCell GetCell(UITableView tableView, NSIndexPath indexPath)\n{\n    // 1\n    UITableViewCell cell = tableView.DequeueReusableCell(cellIdentifier);\n    if (cell == null)\n    {\n        cell = new UITableViewCell(UITableViewCellStyle.Default, cellIdentifier);\n    }\n\n    Task task = tasks[indexPath.Row];\n\n    // 2\n    cell.TextLabel.Text = task.body;\n    var taskComplete = task.isCompleted;\n\n    //Checks whether the tasks has been completed or not\n    if (taskComplete)\n    {\n        cell.Accessory = UITableViewCellAccessory.Checkmark;\n    }\n    else\n    {\n        cell.Accessory = UITableViewCellAccessory.None;\n    }\n\n    // 3\n    var tapGesture = new UITapGestureRecognizer();\n    tapGesture.AddTarget(() =>\n    {\n        if (taskComplete)\n        {\n            collection.FindById(task._id).Update(mutableDoc =>\n                mutableDoc["isCompleted"].Set(false)\n            );\n        }\n        else\n        {\n            collection.FindById(task._id).Update(mutableDoc =>\n                mutableDoc["isCompleted"].Set(true)\n            );\n        }\n    });\n    cell.AddGestureRecognizer(tapGesture);\n\n    return cell;\n}\n')),(0,a.kt)("p",null,"The next thing to add to our ",(0,a.kt)("inlineCode",{parentName:"p"},"TasksTableSource")," is the ",(0,a.kt)("inlineCode",{parentName:"p"},"updateTasks")," method we called earlier.\nThis method will take a list of Tasks and then assign it to our Tasks array that is used for displaying the tasks."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},"public void updateTasks(List<Task> tasks)\n{\n    this.tasks = tasks.ToArray();\n}\n")),(0,a.kt)("p",null,"The last thing that we need to do is to add a way to delete any tasks that we no longer want.\nTo do so, we will override the ",(0,a.kt)("inlineCode",{parentName:"p"},"CommitEditingStyle")," method. This method has a default delete value and so we just need to tell the app what to do when the delete is called. In this case, we want to remove the task document from the Ditto Collection. When we remove that documents the live query we setup earlier will be called and will refresh the UI with the removed task."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},'public override void CommitEditingStyle(UITableView tableView, UITableViewCellEditingStyle editingStyle, Foundation.NSIndexPath indexPath)\n{\n    switch (editingStyle)\n    {\n        case UITableViewCellEditingStyle.Delete:\n\n            var task = tasks[indexPath.Row];\n            collection.FindById(task._id).Update((mutableDoc) => {\n                if (mutableDoc == null) return;\n                mutableDoc["isDeleted"].Set(true);\n            });\n\n            break;\n        case UITableViewCellEditingStyle.None:\n            Console.WriteLine("CommitEditingStyle:None called");\n            break;\n    }\n}\n')),(0,a.kt)("h2",{id:"4-4-final-application"},"4-4 Final Application"),(0,a.kt)("p",null,"Our application is complete! Our TasksTableSource.cs file should look like the following."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp",metastring:'title="TasksTableSource.cs"',title:'"TasksTableSource.cs"'},'using System;\nusing System.Collections.Generic;\nusing Foundation;\nusing UIKit;\nusing DittoSDK;\n\nnamespace Tasks\n{\n    public class TasksTableSource : UITableViewSource\n    {\n        Task[] tasks;\n        NSString cellIdentifier = new NSString("taskCell");\n\n        private DittoCollection collection\n        {\n            get\n            {\n                return this.ditto.Store.Collection("tasks");\n            }\n        }\n\n        private Ditto ditto\n        {\n            get\n            {\n                var appDelegate = (AppDelegate)UIApplication.SharedApplication.Delegate;\n                return appDelegate.ditto;\n            }\n        }\n\n        public TasksTableSource(Task[] taskList)\n        {\n            this.tasks = taskList;\n        }\n\n        public TasksTableSource()\n        {\n        }\n\n        public override UITableViewCell GetCell(UITableView tableView, NSIndexPath indexPath)\n        {\n            UITableViewCell cell = tableView.DequeueReusableCell(cellIdentifier);\n            if (cell == null)\n            {\n                cell = new UITableViewCell(UITableViewCellStyle.Default, cellIdentifier);\n            }\n\n            Task task = tasks[indexPath.Row];\n\n            cell.TextLabel.Text = task.body;\n            var taskComplete = task.isCompleted;\n            if (taskComplete)\n            {\n                cell.Accessory = UITableViewCellAccessory.Checkmark;\n            }\n            else\n            {\n                cell.Accessory = UITableViewCellAccessory.None;\n\n            }\n\n            var tapGesture = new UITapGestureRecognizer();\n            tapGesture.AddTarget(() =>\n            {\n                if (taskComplete)\n                {\n                    collection.FindById(task._id).Update(mutableDoc =>\n                        mutableDoc["isCompleted"].Set(false)\n                    );\n                }\n                else\n                {\n                    collection.FindById(task._id).Update(mutableDoc =>\n                        mutableDoc["isCompleted"].Set(true)\n                    );\n                }\n            });\n            cell.AddGestureRecognizer(tapGesture);\n\n            return cell;\n\n        }\n\n        public override nint RowsInSection(UITableView tableview, nint section)\n        {\n            if (this.tasks == null)\n            {\n                return 0;\n            }\n            return tasks.Length;\n        }\n\n        public void updateTasks(List<Task> tasks)\n        {\n            this.tasks = tasks.ToArray();\n        }\n\n        public override void CommitEditingStyle(UITableView tableView, UITableViewCellEditingStyle editingStyle, Foundation.NSIndexPath indexPath)\n        {\n            switch (editingStyle)\n            {\n                case UITableViewCellEditingStyle.Delete:\n\n                    var task = tasks[indexPath.Row];\n                    collection.FindById(task._id).Update((mutableDoc) => {\n                        if (mutableDoc == null) return;\n                        mutableDoc["isDeleted"].Set(true);\n                    });\n\n                    break;\n                case UITableViewCellEditingStyle.None:\n                    Console.WriteLine("CommitEditingStyle:None called");\n                    break;\n            }\n        }\n    }\n}\n\n')),(0,a.kt)("p",null,"Congratulations you are now complete with the Ditto Xamarin.iOS task app!"))}p.isMDXComponent=!0}}]);