"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[4099],{3905:function(e,n,t){t.d(n,{Zo:function(){return p},kt:function(){return m}});var i=t(67294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function a(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,i,r=function(e,n){if(null==e)return{};var t,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)t=o[i],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)t=o[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var l=i.createContext({}),c=function(e){var n=i.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):a(a({},n),e)),t},p=function(e){var n=c(e.components);return i.createElement(l.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return i.createElement(i.Fragment,{},n)}},u=i.forwardRef((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),u=c(t),m=r,h=u["".concat(l,".").concat(m)]||u[m]||d[m]||o;return t?i.createElement(h,a(a({ref:n},p),{},{components:t})):i.createElement(h,a({ref:n},p))}));function m(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,a=new Array(o);a[0]=u;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,a[1]=s;for(var c=2;c<o;c++)a[c]=t[c];return i.createElement.apply(null,a)}return i.createElement.apply(null,t)}u.displayName="MDXCreateElement"},33835:function(e,n,t){t.r(n),t.d(n,{contentTitle:function(){return l},default:function(){return u},frontMatter:function(){return s},metadata:function(){return c},toc:function(){return p}});var i=t(87462),r=t(63366),o=(t(67294),t(3905)),a=["components"],s={title:"Access Control Permissions",sidebar_position:13},l=void 0,c={unversionedId:"concepts/designing-permissions",id:"concepts/designing-permissions",isDocsHomePage:!1,title:"Access Control Permissions",description:"You can describe permissions attributed using a JSON",source:"@site/docs/common/concepts/designing-permissions.mdx",sourceDirName:"concepts",slug:"/concepts/designing-permissions",permalink:"/common/concepts/designing-permissions",editUrl:"https://github.com/getditto/docs/edit/main/docs/common/concepts/designing-permissions.mdx",tags:[],version:"current",sidebarPosition:13,frontMatter:{title:"Access Control Permissions",sidebar_position:13},sidebar:"defaultSidebar",previous:{title:"Removing",permalink:"/common/concepts/remove"},next:{title:"Overview",permalink:"/common/mesh-network/supported-transports"}},p=[{value:"Rejecting a user",id:"rejecting-a-user",children:[],level:2},{value:"Accepting a user",id:"accepting-a-user",children:[],level:2},{value:"Access Control Permissions",id:"access-control-permissions",children:[{value:"Example",id:"example",children:[],level:3}],level:2}],d={toc:p};function u(e){var n=e.components,t=(0,r.Z)(e,a);return(0,o.kt)("wrapper",(0,i.Z)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"You can describe permissions attributed using a JSON\ndocument. This JSON document is encoded within the certificate used by each\ndevice. Each peer verifies the cerificates of other peers, and accepts or rejects reads\nand writes based on these permissions."),(0,o.kt)("p",null,"For example, "),(0,o.kt)("p",null,"You can issue each certificiate ",(0,o.kt)("a",{parentName:"p",href:"../how-it-works/certificate-security"},"manually")," or with the ",(0,o.kt)("a",{parentName:"p",href:"../security/online-with-authentication"},"Online with\nAuthentication identity"),". "),(0,o.kt)("h2",{id:"rejecting-a-user"},"Rejecting a user"),(0,o.kt)("p",null,"To reject a user from reading or writing at all, specify the JSON payload below."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsonc"},'{\n  "authenticate": false\n}\n')),(0,o.kt)("h2",{id:"accepting-a-user"},"Accepting a user"),(0,o.kt)("p",null,"To grant full ",(0,o.kt)("inlineCode",{parentName:"p"},"read")," & ",(0,o.kt)("inlineCode",{parentName:"p"},"write")," permissions to ",(0,o.kt)("em",{parentName:"p"},"all collections")," and ",(0,o.kt)("em",{parentName:"p"},"all documents"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsonc"},'{\n  "authenticate": true,\n  "expirationSeconds": 28800,\n  "userID": "123abc",\n  "permissions": {\n    "read": {\n      "everything": true,\n      "queriesByCollection": {}\n    },\n    "write": {\n      "everything": true,\n      "queriesByCollection": {}\n    }\n  }\n}\n')),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"authenticate")," to ",(0,o.kt)("inlineCode",{parentName:"li"},"true")," to tell the webhook that the user has successfully validated"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"expirationSeconds")," is ",(0,o.kt)("inlineCode",{parentName:"li"},"number")," property on how long the authentication session is valid for before a refresh is required."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"userID")," is a ",(0,o.kt)("inlineCode",{parentName:"li"},"string")," which identifies the the ",(0,o.kt)("inlineCode",{parentName:"li"},"userID"),". This should be ",(0,o.kt)("em",{parentName:"li"},"unique")," across users within your app. "),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"permissions")," which describes all the types of access control for collections and documents that this user can ",(0,o.kt)("inlineCode",{parentName:"li"},"read")," or ",(0,o.kt)("inlineCode",{parentName:"li"},"write"))),(0,o.kt)("h2",{id:"access-control-permissions"},"Access Control Permissions"),(0,o.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Currently, you can ",(0,o.kt)("strong",{parentName:"p"},"only specify a permission query on the ",(0,o.kt)("inlineCode",{parentName:"strong"},"_id")," field of a\ndocument"),". Mutable properties are currently not supported. We are working on\nadding this feature.  "))),(0,o.kt)("p",null,"To grant selective permissions on specific documents, add to the\n",(0,o.kt)("inlineCode",{parentName:"p"},"queriesByCollection")," property inside either the ",(0,o.kt)("inlineCode",{parentName:"p"},"read")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"write")," property.\nEach key inside ",(0,o.kt)("inlineCode",{parentName:"p"},"queriesByCollection")," is a reference to the collection. Each\nvalue is an array of ",(0,o.kt)("a",{parentName:"p",href:"../concepts/querying"},"ditto queries")," describing which\ndocuments the user can read or write."),(0,o.kt)("h3",{id:"example"},"Example"),(0,o.kt)("p",null,"The following write permissions below describe that ",(0,o.kt)("inlineCode",{parentName:"p"},'userID: "123abc"')," can"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("inlineCode",{parentName:"li"},"write")," to documents in the ",(0,o.kt)("inlineCode",{parentName:"li"},'"books"')," collection where the ",(0,o.kt)("inlineCode",{parentName:"li"},"_id.title")," value ",(0,o.kt)("inlineCode",{parentName:"li"},"endsWith('Potter')"),"."),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("inlineCode",{parentName:"li"},"write")," to any document in the ",(0,o.kt)("inlineCode",{parentName:"li"},'"newspapers"')," collection. We use a single value of ",(0,o.kt)("inlineCode",{parentName:"li"},"true")," "),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("inlineCode",{parentName:"li"},"read")," to documents in the ",(0,o.kt)("inlineCode",{parentName:"li"},'"books"')," collection where the ",(0,o.kt)("inlineCode",{parentName:"li"},"_id.title")," value ",(0,o.kt)("inlineCode",{parentName:"li"},"endsWith('Potter')"),".")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsonc"},'{\n  "authenticate": true,\n  "expirationSeconds": 28800,\n  "userID": "123abc",\n  "permissions": {\n    "write": {\n      "everything": false, // ensure that this is false\n      "queriesByCollection": {\n        // highlight-start\n        // 1. \n        "books": [\n          "endsWith(_id.title, \'Potter\')"\n        ],\n        // highlight-end\n        \n        // highlight-start\n        // 2. \n        "newspapers": [\n          "true"\n        ]\n        // highlight-end\n      }\n    },\n    "read": {\n      "everything": false, // ensure that this is false\n      "queriesByCollection": {\n        // highlight-start\n        // 3.\n        "books": [\n          "endsWith(_id.title, \'Potter\')"\n        ],\n        // highlight-end\n      }\n    }\n  }\n}\n')),(0,o.kt)("p",null,"Here is a full example for a complex permissions query: "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsonc"},'{\n  "authenticate": true,\n  "identity": {\n      "provider": "facebook",\n      "id": true\n  },\n  "expirationSeconds": 3600,\n  "permissions": {\n      "read": {\n          "everything": true,\n          "queriesByCollection": {\n              "cars": ["_id == \'my-specific-id\'", "_id == \'id1\' || _id == \'id2"],\n              "boats": ["_id > 100", "_id > -10 && _id < 10"],\n              "foods": ["_id == false"],\n              "books": ["endsWith(_id, \'Potter\')"]\n          }\n      },\n      "write": {\n          "everything": true,\n          "queriesByCollection": {\n              "cars": ["_id.price > 1500 && _id.currency == \'USD\'", "_id.color == \'red"],\n              "boats": ["regex(_id, \'^Wave.*\')"]\n          }\n      },\n  }\n}\n')))}u.isMDXComponent=!0}}]);