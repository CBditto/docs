"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[8429],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>k});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),c=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},d=function(e){var t=c(e.components);return a.createElement(s.Provider,{value:t},e.children)},u="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),u=c(n),h=r,k=u["".concat(s,".").concat(h)]||u[h]||p[h]||i;return n?a.createElement(k,l(l({ref:t},d),{},{components:n})):a.createElement(k,l({ref:t},d))}));function k(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,l=new Array(i);l[0]=h;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[u]="string"==typeof e?e:r,l[1]=o;for(var c=2;c<i;c++)l[c]=n[c];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},43280:(e,t,n)=>{n.r(t),n.d(t,{contentTitle:()=>l,default:()=>d,frontMatter:()=>i,metadata:()=>o,toc:()=>s});var a=n(87462),r=(n(67294),n(3905));const i={title:"3 - Showing the List of Tasks"},l=void 0,o={unversionedId:"tutorial/xamarin/tasks-list-screen",id:"tutorial/xamarin/tasks-list-screen",isDocsHomePage:!1,title:"3 - Showing the List of Tasks",description:"In the last part of the tutorial we setup the user interface using the Xcode interfaace builder and created a custom class TasksTableViewController",source:"@site/docs/csharp/tutorial/xamarin/3-tasks-list-screen.md",sourceDirName:"tutorial/xamarin",slug:"/tutorial/xamarin/tasks-list-screen",permalink:"/csharp/tutorial/xamarin/tasks-list-screen",editUrl:"https://github.com/getditto/docs/tree/main/docs/csharp/tutorial/xamarin/3-tasks-list-screen.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{title:"3 - Showing the List of Tasks"},sidebar:"docs",previous:{title:"2 - Configure Ditto",permalink:"/csharp/tutorial/xamarin/configure-ditto"},next:{title:"4 - Editing Tasks",permalink:"/csharp/tutorial/xamarin/edit-screen"}},s=[{value:"3-1 Setup TasksTableViewController class",id:"3-1-setup-taskstableviewcontroller-class",children:[],level:2}],c={toc:s};function d(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"In the last part of the tutorial we setup the user interface using the Xcode interfaace builder and created a custom class TasksTableViewController"),(0,r.kt)("h2",{id:"3-1-setup-taskstableviewcontroller-class"},"3-1 Setup TasksTableViewController class"),(0,r.kt)("p",null,"First, we need to add some variables that will be created on ",(0,r.kt)("inlineCode",{parentName:"p"},"viewDidLoad")," of the ",(0,r.kt)("inlineCode",{parentName:"p"},"TasksTableViewController")," so adjust the class to match this code:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp",metastring:'title="TasksTableViewController.cs"',title:'"TasksTableViewController.cs"'},'using System;\nusing UIKit;\n// Remember to import Ditto\nusing DittoSDK;\nusing System.Collections.Generic;\n\nnamespace Tasks\n{\n    public partial class TasksTableViewController : UITableViewController\n    {\n        // These hold references to Ditto for easy access\n        private DittoLiveQuery liveQuery;\n        private DittoSubscription subscription;\n        private Ditto ditto\n        {\n            get\n            {\n                var appDelegate = (AppDelegate)UIApplication.SharedApplication.Delegate;\n                return appDelegate.ditto;\n            }\n        }\n        private DittoCollection collection\n        {\n            get\n            {\n                return this.ditto.Store.Collection("tasks");\n            }\n        }\n\n        // List that will contain all the tasks\n        List<Task> tasks = new List<Task>();\n\n        // data source for the TasksTableViewController\n        private TasksTableSource tasksTableSource = new TasksTableSource();\n\n        public TasksTableViewController(IntPtr handle) : base(handle)\n        {\n        }\n\n        public override void ViewWillAppear(bool animated)\n        {\n            base.ViewWillAppear(animated);\n\n            TableView.Source = tasksTableSource;\n        }\n\n        public override void ViewDidLoad()\n        {\n            base.ViewDidLoad();\n            setupTaskList();\n        }\n\n        // Sets up Live Query for syncing\n        public void setupTaskList()\n        {\n            subscription = ditto.Store["tasks"].Find("!isDeleted").Subscribe()\n            liveQuery = ditto.Store["tasks"].Find("!isDeleted").ObserveLocal((docs, _event) =>\n            {\n                tasks = docs.ConvertAll(d => new Task(d));\n                tasksTableSource.updateTasks(tasks);\n\n                InvokeOnMainThread(() =>\n                {\n                    TableView.ReloadData();\n                });\n\n            });\n            \n            ditto.Store["tasks"].Find("isDeleted == true").Evict();\n        }\n\n        // Creates a new task\n        partial void didClickAddTask(UIBarButtonItem sender)\n        {\n            // Create an alert\n            var alertControl = UIAlertController.Create(\n                title: "Add New Task",\n                message: null,\n                preferredStyle: UIAlertControllerStyle.Alert);\n\n            // Add a text field to the alert for the new task text\n            alertControl.AddTextField(configurationHandler: (UITextField obj) => obj.Placeholder = "Enter Task");\n\n            alertControl.AddAction(UIAlertAction.Create(title: "Cancel", style: UIAlertActionStyle.Cancel, handler: null));\n\n            // Add a "OK" button to the alert.\n            alertControl.AddAction(UIAlertAction.Create(title: "OK", style: UIAlertActionStyle.Default, alarm => addTask(alertControl.TextFields[0].Text)));\n\n            // Present the alert to the user\n            PresentViewController(alertControl, animated: true, null);\n        }\n\n        public void addTask(string text)\n        {\n            var dict = new Dictionary<string, object>\n            {\n                {"body", text},\n                {"isCompleted", false}\n            };\n\n            var docId = this.collection.Upsert(dict);\n        }\n    }\n}\n')),(0,r.kt)("p",null,"Let's break down what this code does. First, we create the variables needed and then initialize them in ",(0,r.kt)("inlineCode",{parentName:"p"},"ViewWillAppear()"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},'// These hold references to Ditto for easy access\nprivate DittoLiveQuery liveQuery;\nprivate Ditto ditto\n{\n    get\n    {\n        var appDelegate = (AppDelegate)UIApplication.SharedApplication.Delegate;\n        return appDelegate.ditto;\n    }\n}\nprivate DittoCollection collection\n{\n    get\n    {\n        return this.ditto.Store.Collection("tasks");\n    }\n}\n\n// List that will contain all the tasks\nList<Task> tasks = new List<Task>();\n\n// data source for the TasksTableViewController\nprivate TasksTableSource tasksTableSource = new TasksTableSource();\n\npublic TasksTableViewController(IntPtr handle) : base(handle)\n{\n}\n\npublic override void ViewWillAppear(bool animated)\n{\n    base.ViewWillAppear(animated);\n\n    TableView.Source = tasksTableSource;\n}\n')),(0,r.kt)("p",null,"After setting up the variables and starting Ditto, we then use Ditto's key API to observe changes to the database by creating a live-query in the ",(0,r.kt)("inlineCode",{parentName:"p"},"setupTaskList()")," function. This allows us to set the initial state of the UITableView after the query is immediately run and then subsequently get callbacks for any new data changes that occur locally or that were synced from other devices:"),(0,r.kt)("p",null,"Note, that we are using the ",(0,r.kt)("inlineCode",{parentName:"p"},"observe")," API in Ditto. This API performs two functions. First, it sets up a local observer for data changes in the database that match the query and second it creates a subscription for the same query that will be used to request this data from other devices. For simplicity, we are using this combined API, but you can also call them independently."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},'public override void ViewDidLoad()\n{\n    base.ViewDidLoad();\n    setupTaskList();\n}\n\n// Sets up Live Query for syncing\npublic void setupTaskList()\n{\n    liveQuery = ditto.Store["tasks"].Find("!isDeleted").ObserveLocal((docs, _event) =>\n    {\n        tasks = docs.ConvertAll(d => new Task(d));\n\n        // We will implement this later\n        tasksTableSource.updateTasks(tasks);\n\n        InvokeOnMainThread(() =>\n        {\n            TableView.ReloadData();\n        });\n\n    });\n}\n')),(0,r.kt)("p",null,"This is a best-practice when using Ditto, since it allows your UI to simply react to data changes which can come at any time given the ad-hoc nature of how Ditto synchronizes with nearby devices. With this in place, we can now add user actions and configure the UITableview to display the tasks."),(0,r.kt)("p",null,"Look in the ",(0,r.kt)("inlineCode",{parentName:"p"},"TasksTableViewController.design.cs")," file and you should see ",(0,r.kt)("inlineCode",{parentName:"p"},'[Action ("didClickAddTask:")]')," ",(0,r.kt)("inlineCode",{parentName:"p"},"partial void didClickAddTask (UIKit.UIBarButtonItem sender);"),". This is the button we created earlier in Xcode.\nNow we need to add an action to it."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},'// Triggered when add button is pressed\npartial void didClickAddTask(UIBarButtonItem sender)\n{\n    // Create an alert\n    var alertControl = UIAlertController.Create(\n        title: "Add New Task",\n        message: null,\n        preferredStyle: UIAlertControllerStyle.Alert);\n\n    // Add a text field to the alert for the new task text\n    alertControl.AddTextField(configurationHandler: (UITextField obj) => obj.Placeholder = "Enter Task");\n\n    alertControl.AddAction(UIAlertAction.Create(title: "Cancel", style: UIAlertActionStyle.Cancel, handler: null));\n\n    // Add an "OK" button to the alert.\n    alertControl.AddAction(UIAlertAction.Create(title: "OK", style: UIAlertActionStyle.Default, alarm => addTask(alertControl.TextFields[0].Text)));\n\n    // Present the alert to the user\n    PresentViewController(alertControl, animated: true, null);\n}\n\npublic void addTask(string text)\n{\n\n    var dict = new Dictionary<string, object>\n    {\n        {"body", text},\n        {"isCompleted", false},\n        {"isDeleted", false}\n    };\n\n    // Adds the new task to the ditto collection\n    var docId = this.collection.Upsert(dict);\n}\n')),(0,r.kt)("p",null,"When we ",(0,r.kt)("inlineCode",{parentName:"p"},"Upsert")," the new task into the ditto collection then the live query that is observing the collection will be triggered."))}d.isMDXComponent=!0}}]);